<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>The Book of the Four Actions - Respuestas</title>
  <style>
    :root{
      --iron-1: #666b6d;
      --iron-2: #7a7f81;
      --text-dark: #111;
      --white: #fff;
      --link: #0070f3;
      --link-hover: #005bb5;
      --card-bg: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.04));
    }

    /* Permitir scroll en toda la página y mantener el look */
    html, body{
      min-height: 100%;
      height: auto;
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background-color: var(--iron-1);
      color: var(--white);
    }

    body{
      background-image:
        linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.04)),
        repeating-linear-gradient(180deg, rgba(0,0,0,0.06) 0 2px, transparent 2px 30px);
      padding: 20px;
      box-sizing: border-box;
    }

    .container{
      width: 100%;
      max-width: 1000px;
      margin: 0 auto; /* centrar en desktop */
    }

    .card{
      background: var(--card-bg);
      border-radius: 10px;
      padding: 24px;
    }

    .title{
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
      margin-bottom: 18px;
      text-align: center;
    }

    .title .line{
      padding: 8px 14px;
      border-radius: 6px;
      font-weight: 700;
      letter-spacing: .6px;
      text-transform: uppercase;
      background: #111;
      color: #fff;
      font-size: clamp(18px, 4.6vw, 30px);
      line-height: 1.15;
      word-wrap: break-word;
      overflow-wrap: anywhere;
    }

    h2.subtitle{
      margin: 8px 0 18px 0;
      text-align: center;
      font-size: clamp(16px,3.4vw,20px);
      background: linear-gradient(90deg,#cfcfcf,#e9e9e9);
      color: var(--text-dark);
      border-radius: 6px;
      display: inline-block;
      padding: 8px 14px;
    }

    /* Lista de audios */
    #audioList{
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 16px;
    }
    @media (max-width: 720px){
      #audioList{ grid-template-columns: 1fr; }
    }

    .audio-item{
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 12px;
      padding: 14px;
    }

    /* No mostramos meta de usuario/duración */
    .audio-meta{ display: none !important; }

    audio{
      width: 100%;
      max-width: 100%;
      border-radius: 8px;
      outline: none;
      display: block;
    }

    /* Link a more */
    .more-audios-link{
      margin-top: 22px;
      text-align: center;
    }
    .more-audios-link .btn{
      display: inline-block;
      background-color: var(--link);
      color: #fff;
      padding: 10px 16px;
      border-radius: 8px;
      text-decoration: none;
      font-weight: 700;
    }
    .more-audios-link .btn:hover{ background-color: var(--link-hover); }

    /* Estado de carga / error */
    .state{
      text-align: center;
      margin: 16px 0;
      opacity: .9;
      font-size: .95rem;
    }
  </style>
</head>
<body>
  <main class="container">
    <section class="card" aria-labelledby="answersTitle">
      <div class="title" id="answersTitle">
        <span class="line">The Book of the</span>
        <span class="line">Four Actions</span>
      </div>

      <h2 class="subtitle">Escucha lo que otras personas respondieron</h2>

      <div id="state" class="state">Cargando audios…</div>
      <div id="audioList" aria-live="polite"></div>

      <div class="more-audios-link">
        <a href="/interaction/more.html" class="btn">¿Quieres escuchar más audios?</a>
      </div>
    </section>
  </main>

  <script type="module">
    import { showRandomAnswers } from '../assets/js/showAudios.js';

    const audioListDiv = document.getElementById('audioList');
    const stateDiv = document.getElementById('state');

    // Fallback: cuando el JS inyecte <audio>, asegúrate de precargar metadata
    const ensureAudioMetadata = (root) => {
      const audios = root.querySelectorAll('audio');
      audios.forEach(a => {
        a.preload = 'metadata';
        a.addEventListener('loadedmetadata', () => { a.currentTime = 0; }, { once: true });
        // En algunos navegadores ayuda forzar load()
        try { a.load(); } catch(_) {}
      });
    };

    async function load() {
      try {
        await showRandomAnswers(audioListDiv, { hideMeta: true }); 
        stateDiv.style.display = 'none';
        ensureAudioMetadata(audioListDiv);
      } catch (e) {
        console.error(e);
        stateDiv.textContent = 'Error al cargar audios.';
      }
    }

    load();

    // Por si en el futuro se vuelven a inyectar elementos de forma dinámica
    const obs = new MutationObserver(muts => {
      for (const m of muts) {
        m.addedNodes.forEach(n => {
          if (n.nodeType === 1) {
            if (n.tagName === 'AUDIO') ensureAudioMetadata(n.parentNode || document);
            else ensureAudioMetadata(n);
          }
        });
      }
    });
    obs.observe(audioListDiv, { childList: true, subtree: true });
  </script>
</body>
</html>
